<div class="bg-white rounded-lg shadow-lg p-6 mb-6">
  <form [formGroup]="searchForm" (ngSubmit)="onSubmit()" class="space-y-6">
    
    <!-- Search Mode Toggle -->
    <div class="flex justify-center mb-6">
      <mat-button-toggle-group 
        value="train" 
        (change)="onSearchModeToggle($event.value)"
        class="bg-blue-50">
        <mat-button-toggle value="train" class="px-8 py-2">
          <span class="flex items-center">
            üöÇ Train Search
          </span>
        </mat-button-toggle>
        <mat-button-toggle value="flight" class="px-8 py-2">
          <span class="flex items-center">
            ‚úàÔ∏è Flight Search
          </span>
        </mat-button-toggle>
      </mat-button-toggle-group>
    </div>

    <!-- Form Fields Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      
      <!-- Source -->
      <mat-form-field appearance="outline" class="w-full">
        <mat-label>
          {{ searchMode === 'train' ? 'From Station' : 'From Airport' }}
        </mat-label>
        <mat-select formControlName="sourceID" required>
          <mat-option 
            *ngFor="let item of sourceList" 
            [value]="getItemId(item)">
            {{ getDisplayName(item) }}
          </mat-option>
        </mat-select>
        <mat-error *ngIf="searchForm.get('sourceID')?.hasError('required') && searchForm.get('sourceID')?.touched">
          Source is required
        </mat-error>
      </mat-form-field>

      <!-- Destination -->
      <mat-form-field appearance="outline" class="w-full">
        <mat-label>
          {{ searchMode === 'train' ? 'To Station' : 'To Airport' }}
        </mat-label>
        <mat-select formControlName="destinationID" required>
          <mat-option 
            *ngFor="let item of destinationList" 
            [value]="getItemId(item)">
            {{ getDisplayName(item) }}
          </mat-option>
        </mat-select>
        <mat-error *ngIf="searchForm.get('destinationID')?.hasError('required') && searchForm.get('destinationID')?.touched">
          Destination is required
        </mat-error>
      </mat-form-field>

      <!-- Travel Date -->
      <mat-form-field appearance="outline" class="w-full">
        <mat-label>Travel Date</mat-label>
        <input 
          matInput 
          [matDatepicker]="picker" 
          formControlName="travelDate"
          [min]="minDate"
          required>
        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
        <mat-error *ngIf="searchForm.get('travelDate')?.hasError('required') && searchForm.get('travelDate')?.touched">
          Travel date is required
        </mat-error>
      </mat-form-field>

      <!-- Passenger Count -->
      <mat-form-field appearance="outline" class="w-full">
        <mat-label>Passengers</mat-label>
        <mat-select formControlName="passengerCount" required>
          <mat-option value="1">1 Passenger</mat-option>
          <mat-option value="2">2 Passengers</mat-option>
          <mat-option value="3">3 Passengers</mat-option>
          <mat-option value="4">4 Passengers</mat-option>
          <mat-option value="5">5 Passengers</mat-option>
          <mat-option value="6">6 Passengers</mat-option>
        </mat-select>
        <mat-error *ngIf="searchForm.get('passengerCount')?.invalid && searchForm.get('passengerCount')?.touched">
          Please select passenger count (1-6)
        </mat-error>
      </mat-form-field>

      <!-- Train-specific fields -->
      <div *ngIf="searchMode === 'train'" class="contents">
        <!-- Train Class -->
        <mat-form-field appearance="outline" class="w-full">
          <mat-label>Class (Optional)</mat-label>
          <mat-select formControlName="trainClassID">
            <mat-option value="">Any Class</mat-option>
            <mat-option 
              *ngFor="let trainClass of trainClasses" 
              [value]="trainClass.trainClassID">
              {{ trainClass.className }}
              <span *ngIf="trainClass.description" class="text-gray-500"> - {{ trainClass.description }}</span>
            </mat-option>
          </mat-select>
        </mat-form-field>

        <!-- Quota Type -->
        <mat-form-field appearance="outline" class="w-full">
          <mat-label>Quota (Optional)</mat-label>
          <mat-select formControlName="quotaTypeID">
            <mat-option value="">Any Quota</mat-option>
            <mat-option 
              *ngFor="let quota of trainQuotaTypes" 
              [value]="quota.quotaTypeID">
              {{ quota.quotaName }}
              <span *ngIf="quota.description" class="text-gray-500"> - {{ quota.description }}</span>
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>

      <!-- Flight-specific fields -->
      <div *ngIf="searchMode === 'flight'" class="contents">
        <!-- Flight Class -->
        <mat-form-field appearance="outline" class="w-full">
          <mat-label>Class (Optional)</mat-label>
          <mat-select formControlName="flightClassID">
            <mat-option value="">Any Class</mat-option>
            <mat-option 
              *ngFor="let flightClass of flightClasses" 
              [value]="flightClass.flightClassID">
              {{ flightClass.className }}
              <span *ngIf="flightClass.description" class="text-gray-500"> - {{ flightClass.description }}</span>
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </div>

    <!-- Submit Button -->
    <div class="flex justify-center pt-4">
      <button 
        mat-raised-button 
        color="primary" 
        type="submit"
        [disabled]="searchForm.invalid || isLoading"
        class="px-12 py-3 text-lg">
        <mat-spinner 
          *ngIf="isLoading" 
          diameter="20" 
          class="mr-2 inline-block">
        </mat-spinner>
        {{ isLoading ? 'Searching...' : 'Search ' + (searchMode === 'train' ? 'Trains' : 'Flights') }}
      </button>
    </div>
  </form>
</div>